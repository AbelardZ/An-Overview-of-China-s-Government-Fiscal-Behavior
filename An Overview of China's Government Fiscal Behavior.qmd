---
title: "An Overview of China's Government Fiscal Behavior"
format: html
editor: visual
author: å¼ é¢¢ä¸¥
---

ğŸ˜‰

## GDPå’Œä¸€èˆ¬å…¬å…±é¢„ç®—æ”¶å…¥ï¼ˆå…¨å›½ï¼‰å¢é€Ÿå¯¹æ¯”

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)
library(dplyr)
library(ggplot2)

# è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\GDPvsé¢„ç®—æ”¶å…¥.xlsx")
# å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡
colnames(data) <- c("Index", "Year", "GDP", "PublicRevenue")

# æ¸…ç†æ•°æ®ï¼Œç§»é™¤ç©ºè¡Œ
data <- data %>% filter(!is.na(Year))

# ä»…ä¿ç•™1992-2023å¹´çš„æ•°æ®
data <- data %>% filter(Year >= 1992 & Year <= 2023)

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# è®¡ç®—GDPå¢é€Ÿå’Œä¸€èˆ¬å…¬å…±é¢„ç®—æ”¶å…¥å¢é€Ÿ
data <- data %>%
  mutate(GDP_Growth = (GDP - lag(GDP)) / lag(GDP) * 100,
         PublicRevenue_Growth = (PublicRevenue - lag(PublicRevenue)) / lag(PublicRevenue) * 100)

# ç§»é™¤ç¬¬ä¸€è¡Œï¼ˆå› ä¸ºå¢é€Ÿè®¡ç®—ä¼šäº§ç”ŸNAï¼‰
data <- data %>% filter(!is.na(GDP_Growth))

# ç»˜åˆ¶æŠ˜çº¿å›¾
ggplot(data, aes(x = Year)) +
  geom_line(aes(y = GDP_Growth, color = "GDP Growth"), group = 1) +
  geom_line(aes(y = PublicRevenue_Growth, color = "Public Revenue Growth"), group = 1) +
  labs(title = "GDP Growth vs Public Revenue Growth (1992-2023)",
       x = "Year",
       y = "Growth Rate (%)",
       color = "Indicator") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1992, 2023, by = 5),  # æ¯5å¹´æ˜¾ç¤ºä¸€ä¸ªæ ‡ç­¾
                     labels = seq(1992, 2023, by = 5)) +  # æ ‡ç­¾ä¸ breaks ä¸€è‡´
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # æ—‹è½¬æ¨ªè½´æ ‡ç­¾ï¼Œé¿å…é‡å 

# ç»˜åˆ¶æ•£ç‚¹å›¾
ggplot(data, aes(x = GDP_Growth, y = PublicRevenue_Growth)) +
  geom_point() +
  geom_smooth(method = "lm", col = "blue") +
  labs(title = "Scatter Plot of GDP Growth vs Public Revenue Growth (1992-2023)",
       x = "GDP Growth (%)",
       y = "Public Revenue Growth (%)") +
  theme_minimal()

# è®¡ç®—ç›¸å…³ç³»æ•°
correlation <- cor(data$GDP_Growth, data$PublicRevenue_Growth, use = "complete.obs")
print(paste("The correlation coefficient between GDP Growth and Public Revenue Growth is:", correlation))
```

## ä¸€èˆ¬å…¬å…±é¢„ç®—æ”¶å…¥çš„ç»†åˆ†â… 

```{r}
# åŠ è½½å¿…è¦çš„åº“
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)
# è¯»å– Excel æ–‡ä»¶
df <- read_excel("C:\\Users\\zhy\\Desktop\\è´¢æ”¿æ”¯å‡ºç»†åˆ†.xlsx")

# å¦‚æœåˆ—åä¸æ­£ç¡®ï¼Œæ‰‹åŠ¨è®¾ç½®åˆ—å
colnames(df) <- c("Index", "Year", "Total_Revenue", "Tax_Revenue", "Domestic_VAT", "Non_Tax_Revenue", "GDP","PublicExpenditure")

# æ£€æŸ¥æ•°æ®ç±»å‹
str(df)

# å°† Year åˆ—è½¬æ¢ä¸ºæ•°å€¼å‹
df$Year <- as.numeric(df$Year)

# å°† Tax_Revenueã€Non_Tax_Revenue å’Œ GDP åˆ—è½¬æ¢ä¸ºæ•°å€¼å‹
df$Tax_Revenue <- as.numeric(df$Tax_Revenue)
df$Non_Tax_Revenue <- as.numeric(df$Non_Tax_Revenue)
df$GDP <- as.numeric(df$GDP)

# ç§»é™¤åŒ…å«ç¼ºå¤±å€¼çš„è¡Œ
df <- df %>% drop_na(Tax_Revenue, Non_Tax_Revenue, GDP)

# å†æ¬¡æ£€æŸ¥æ•°æ®
head(df)

# 1. ç»˜åˆ¶ç¨æ”¶æ”¶å…¥å’Œéç¨æ”¶å…¥çš„é¢ç§¯å †ç§¯å›¾
ggplot(df, aes(x = Year)) +
  geom_area(aes(y = Tax_Revenue, fill = "Tax Revenue"), alpha = 0.6) +
  geom_area(aes(y = Non_Tax_Revenue, fill = "Non-Tax Revenue"), alpha = 0.6) +
  labs(
    title = "Tax Revenue and Non-Tax Revenue (Stacked Area Chart)",
    x = "Year",
    y = "Revenue (äº¿ yuan)",
    fill = "Revenue Type"
  ) +
  theme_minimal() +
  scale_fill_manual(
    values = c("Tax Revenue" = "blue", "Non-Tax Revenue" = "red"),  # ç¡®ä¿å€¼ä¸ fill æ˜ å°„ä¸€è‡´
    breaks = c("Tax Revenue", "Non-Tax Revenue")  # æ˜ç¡®æŒ‡å®š breaks
  )

# 2. è®¡ç®—ç¨æ”¶æ”¶å…¥ã€éç¨æ”¶å…¥å’Œ GDP çš„å¢é€Ÿ
df <- df %>%
  mutate(
    Tax_Growth_Rate = (Tax_Revenue - lag(Tax_Revenue)) / lag(Tax_Revenue) * 100,
    Non_Tax_Growth_Rate = (Non_Tax_Revenue - lag(Non_Tax_Revenue)) / lag(Non_Tax_Revenue) * 100,
    GDP_Growth_Rate = (GDP - lag(GDP)) / lag(GDP) * 100
  )

# ç§»é™¤å¢é€Ÿè®¡ç®—ä¸­çš„ç¼ºå¤±å€¼
df <- df %>% drop_na(Tax_Growth_Rate, Non_Tax_Growth_Rate, GDP_Growth_Rate)

# æŸ¥çœ‹å¢é€Ÿæ•°æ®
head(df)

# ç»˜åˆ¶ç¨æ”¶æ”¶å…¥ã€éç¨æ”¶å…¥å’Œ GDP å¢é€Ÿçš„æŠ˜çº¿å›¾
ggplot(df, aes(x = Year, group = 1)) +  # æ˜ç¡®æŒ‡å®š group = 1
  geom_line(aes(y = Tax_Growth_Rate, color = "Tax Revenue Growth Rate"), size = 1) +
  geom_line(aes(y = Non_Tax_Growth_Rate, color = "Non-Tax Revenue Growth Rate"), size = 1) +
  geom_line(aes(y = GDP_Growth_Rate, color = "GDP Growth Rate"), size = 1) +
  labs(
    title = "Tax Revenue, Non-Tax Revenue, and GDP Growth Rate",
    x = "Year",
    y = "Growth Rate (%)",
    color = "Growth Rate Type"
  ) +
  theme_minimal() +
  scale_color_manual(
    values = c(
      "Tax Revenue Growth Rate" = "blue",
      "Non-Tax Revenue Growth Rate" = "red",
      "GDP Growth Rate" = "green"  # æ·»åŠ  GDP å¢é€Ÿçš„é¢œè‰²
    )
  )

# 3. è®¡ç®—ç¨æ”¶æ”¶å…¥å’Œéç¨æ”¶å…¥çš„ç›¸å…³æ€§
correlation <- cor(df$Tax_Revenue, df$Non_Tax_Revenue, use = "complete.obs")
print(paste("Correlation between Tax Revenue and Non-Tax Revenue:", round(correlation, 2)))

# ç»˜åˆ¶ç¨æ”¶æ”¶å…¥å’Œéç¨æ”¶å…¥çš„æ•£ç‚¹å›¾
ggplot(df, aes(x = Tax_Revenue, y = Non_Tax_Revenue)) +
  geom_point(color = "blue", size = 3) +
  geom_smooth(method = "lm", color = "red", linetype = "dashed") +
  labs(
    title = "Scatter Plot: Tax Revenue vs Non-Tax Revenue",
    x = "Tax Revenue (äº¿ yuan)",
    y = "Non-Tax Revenue (äº¿ yuan)"
  ) +
  theme_minimal()
```

## ä¸€èˆ¬å…¬å…±é¢„å†³ç®—æ”¶å…¥ç»†åˆ†â…¡

```{r}
# åŠ è½½å¿…è¦çš„åº“
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)

# è¯»å– Excel æ–‡ä»¶
df <- read_excel("C:\\Users\\zhy\\Desktop\\ç»†åˆ†çš„å…¬å…±å†³ç®—æ”¶å…¥.xlsx")



# è½¬æ¢åˆ—åä¸ºè‹±æ–‡
colnames(df) <- c("Index", "Year", "LocalRevenue", "CorporateTax", "PersonalTax", "VAT", "OtherTax", "PenaltyRevenue", "NonTaxRevenue", "AdministrativeFees")

# æ£€æŸ¥æ•°æ®ç±»å‹
str(df)

# å°† Year åˆ—è½¬æ¢ä¸ºæ•°å€¼å‹
df$Year <- as.numeric(df$Year)

# ç­›é€‰ 2007-2023 å¹´çš„æ•°æ®
df <- df %>% filter(Year >= 2007 & Year <= 2023)

# ç§»é™¤åŒ…å«ç¼ºå¤±å€¼çš„è¡Œ
df <- df %>% drop_na(CorporateTax, PersonalTax, VAT, PenaltyRevenue, AdministrativeFees)

# è®¡ç®—ç¨æ”¶æ€»æ”¶å…¥å’Œéç¨æ€»æ”¶å…¥
df <- df %>%
  mutate(
    TotalTaxRevenue = CorporateTax + PersonalTax + VAT + OtherTax,  # ç¨æ”¶æ€»æ”¶å…¥
    TotalNonTaxRevenue = PenaltyRevenue + AdministrativeFees        # éç¨æ€»æ”¶å…¥
  )

# 1. ç»˜åˆ¶ç¨æ”¶æ”¶å…¥é¢ç§¯å †ç§¯å›¾ï¼ˆåŒ…å«ç¨æ”¶æ€»æ”¶å…¥ï¼‰
ggplot(df, aes(x = Year)) +
  geom_area(aes(y = CorporateTax, fill = "ä¼ä¸šæ‰€å¾—ç¨"), alpha = 0.6) +
  geom_area(aes(y = PersonalTax, fill = "ä¸ªäººæ‰€å¾—ç¨"), alpha = 0.6) +
  geom_area(aes(y = VAT, fill = "å›½å†…å¢å€¼ç¨"), alpha = 0.6) +
  geom_area(aes(y = OtherTax, fill = "å…¶ä»–ç¨æ”¶"), alpha = 0.6) +
  geom_area(aes(y = TotalTaxRevenue, fill = "ç¨æ”¶æ€»æ”¶å…¥"), alpha = 0.6) +  # æ·»åŠ ç¨æ”¶æ€»æ”¶å…¥
  labs(
    title = "2007-2023 å¹´ç¨æ”¶æ”¶å…¥ï¼ˆä¼ä¸šæ‰€å¾—ç¨ã€ä¸ªäººæ‰€å¾—ç¨ã€å›½å†…å¢å€¼ç¨ã€å…¶ä»–ç¨æ”¶ã€ç¨æ”¶æ€»æ”¶å…¥ï¼‰",
    x = "å¹´ä»½",
    y = "é‡‘é¢ï¼ˆäº¿å…ƒï¼‰",
    fill = "ç¨æ”¶ç±»å‹"
  ) +
  theme_minimal() +
  scale_fill_manual(
    values = c(
      "ä¼ä¸šæ‰€å¾—ç¨" = "skyblue",
      "ä¸ªäººæ‰€å¾—ç¨" = "pink",
      "å›½å†…å¢å€¼ç¨" = "green",
      "å…¶ä»–ç¨æ”¶" = "orange",
      "ç¨æ”¶æ€»æ”¶å…¥" = "purple"  # è®¾ç½®ç¨æ”¶æ€»æ”¶å…¥é¢œè‰²
    )
  ) +
  scale_x_continuous(breaks = seq(2007, 2023, by = 2))  # æ¯ä¸¤å¹´æ˜¾ç¤ºä¸€ä¸ªå¹´ä»½æ ‡ç­¾

# 2. ç»˜åˆ¶éç¨æ”¶å…¥é¢ç§¯å †ç§¯å›¾ï¼ˆåŒ…å«éç¨æ€»æ”¶å…¥ï¼‰
ggplot(df, aes(x = Year)) +
  geom_area(aes(y = PenaltyRevenue, fill = "ç½šæ²¡æ”¶å…¥"), alpha = 0.6) +
  geom_area(aes(y = AdministrativeFees, fill = "è¡Œæ”¿äº‹ä¸šæ€§æ”¶è´¹"), alpha = 0.6) +
  geom_area(aes(y = TotalNonTaxRevenue, fill = "éç¨æ€»æ”¶å…¥"), alpha = 0.6) +  # æ·»åŠ éç¨æ€»æ”¶å…¥
  labs(
    title = "2007-2023 å¹´éç¨æ”¶å…¥ï¼ˆç½šæ²¡æ”¶å…¥ã€è¡Œæ”¿äº‹ä¸šæ€§æ”¶è´¹ã€éç¨æ€»æ”¶å…¥ï¼‰",
    x = "å¹´ä»½",
    y = "é‡‘é¢ï¼ˆäº¿å…ƒï¼‰",
    fill = "éç¨æ”¶å…¥ç±»å‹"
  ) +
  theme_minimal() +
  scale_fill_manual(
    values = c(
      "ç½šæ²¡æ”¶å…¥" = "purple",
      "è¡Œæ”¿äº‹ä¸šæ€§æ”¶è´¹" = "pink",
      "éç¨æ€»æ”¶å…¥" = "gray"  # è®¾ç½®éç¨æ€»æ”¶å…¥é¢œè‰²
    )
  ) +
  scale_x_continuous(breaks = seq(2007, 2023, by = 2))  # æ¯ä¸¤å¹´æ˜¾ç¤ºä¸€ä¸ªå¹´ä»½æ ‡ç­¾
```

## GDPå’Œä¸€èˆ¬å…¬å…±é¢„ç®—æ”¯å‡ºï¼ˆå…¨å›½ï¼‰å¢é€Ÿå¯¹æ¯”

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)
library(dplyr)
library(ggplot2)

# è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\GDPvsé¢„ç®—æ”¯å‡º.xlsx")

# å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡
colnames(data) <- c("Index", "Year", "PublicExpenditure", "GDP")

# æ¸…ç†æ•°æ®ï¼Œç§»é™¤ç©ºè¡Œ
data <- data %>% filter(!is.na(Year))

# ä»…ä¿ç•™1992-2023å¹´çš„æ•°æ®
data <- data %>% filter(Year >= 1992 & Year <= 2023)

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# è®¡ç®—é¢„ç®—æ”¯å‡ºå¢é€Ÿå’ŒGDPå¢é€Ÿ
data <- data %>%
  mutate(PublicExpenditure_Growth = (PublicExpenditure - lag(PublicExpenditure)) / lag(PublicExpenditure) * 100,
         GDP_Growth = (GDP - lag(GDP)) / lag(GDP) * 100)

# ç§»é™¤ç¬¬ä¸€è¡Œï¼ˆå› ä¸ºå¢é€Ÿè®¡ç®—ä¼šäº§ç”ŸNAï¼‰
data <- data %>% filter(!is.na(PublicExpenditure_Growth))

# ç»˜åˆ¶æŠ˜çº¿å›¾
ggplot(data, aes(x = Year)) +
  geom_line(aes(y = PublicExpenditure_Growth, color = "Public Expenditure Growth"), group = 1) +
  geom_line(aes(y = GDP_Growth, color = "GDP Growth"), group = 1) +
  labs(title = "Public Expenditure Growth vs GDP Growth (1992-2023)",
       x = "Year",
       y = "Growth Rate (%)",
       color = "Indicator") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1992, 2023, by = 5),  # æ¯5å¹´æ˜¾ç¤ºä¸€ä¸ªæ ‡ç­¾
                     labels = seq(1992, 2023, by = 5)) +  # æ ‡ç­¾ä¸ breaks ä¸€è‡´
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # æ—‹è½¬æ¨ªè½´æ ‡ç­¾ï¼Œé¿å…é‡å 

# ç»˜åˆ¶æ•£ç‚¹å›¾
ggplot(data, aes(x = GDP_Growth, y = PublicExpenditure_Growth)) +
  geom_point() +
  geom_smooth(method = "lm", col = "blue") +
  labs(title = "Scatter Plot of Public Expenditure Growth vs GDP Growth (1992-2023)",
       x = "GDP Growth (%)",
       y = "Public Expenditure Growth (%)") +
  theme_minimal()

# è®¡ç®—ç›¸å…³ç³»æ•°
correlation <- cor(data$GDP_Growth, data$PublicExpenditure_Growth, use = "complete.obs")
print(paste("The correlation coefficient between Public Expenditure Growth and GDP Growth is:", correlation))
```

## ä¸€èˆ¬å…¬å…±é¢„å†³ç®—æ”¶å…¥ç»†åˆ†â… 

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)  # ç”¨äºè¯»å–Excelæ–‡ä»¶
library(ggplot2) # ç”¨äºç»˜å›¾
library(reshape2) # ç”¨äºæ•°æ®è½¬æ¢

# 1. è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\ç»†åˆ†å…¬å…±é¢„ç®—æ”¯å‡º.xlsx")

# 2. è½¬æ¢åˆ—åä¸ºè‹±æ–‡
colnames(data) <- c("Index", "Year", "Total_Expenditure", "Public_Services", "Diplomacy", "Defense", "Public_Security", "Education", "Science_Technology", "Culture_Sports_Media", "Social_Security_Employment", "Healthcare_Family_Planning", "Energy_Conservation_Environmental_Protection", "Urban_Rural_Community_Affairs", "Agriculture_Forestry_Water_Affairs", "Transportation", "Resource_Exploration_Electricity_Information", "Commerce_Services", "Financial_Regulation", "Aid_Other_Regions", "Housing_Security", "Grain_Material_Reserves", "National_Debt_Repayment", "Other_Expenditure", "Fiscal_Revenue")

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# 3. ç­›é€‰2007-2023å¹´çš„æ•°æ®
data_filtered <- data[data$Year >= 2007 & data$Year <= 2023, ]

# 4. é€‰æ‹©éœ€è¦çš„åˆ—
selected_data <- data_filtered[, c("Year", "Total_Expenditure", "Education", "Healthcare_Family_Planning", "Social_Security_Employment", "Defense", "Public_Security")]

# 5. å°†æ•°æ®è½¬æ¢ä¸ºé•¿æ ¼å¼
long_data <- melt(selected_data, id.vars = "Year", variable.name = "Expenditure_Type", value.name = "Expenditure_Amount")

# 6. ç»˜åˆ¶é¢ç§¯å †ç§¯å›¾
ggplot(long_data, aes(x = Year, y = Expenditure_Amount, fill = Expenditure_Type)) +
  geom_area() +
  labs(title = "2007-2023 Fiscal Expenditure Stacked Area Chart",
       x = "Year",
       y = "Expenditure Amount",
       fill = "Expenditure Type") +
  theme_minimal()
```

## è´¢æ”¿æ”¶å…¥vsæ”¯å‡º

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)
library(dplyr)
library(ggplot2)

# è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\æ”¶å…¥vsæ”¯å‡º.xlsx")


# å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡
colnames(data) <- c("Year", "PublicRevenue", "PublicExpenditure")

# æ¸…ç†æ•°æ®ï¼Œç§»é™¤ç©ºè¡Œ
data <- data %>% filter(!is.na(Year))

# ä»…ä¿ç•™1992-2023å¹´çš„æ•°æ®
data <- data %>% filter(Year >= 1992 & Year <= 2023)

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# ç»˜åˆ¶ç»å¯¹å€¼å¯¹æ¯”æŠ˜çº¿å›¾
ggplot(data, aes(x = Year)) +
  geom_line(aes(y = PublicRevenue, color = "Public Revenue"), group = 1) +
  geom_line(aes(y = PublicExpenditure, color = "Public Expenditure"), group = 1) +
  labs(title = "Public Revenue vs Public Expenditure (1992-2023)",
       x = "Year",
       y = "Amount (äº¿)",
       color = "Indicator") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1992, 2023, by = 5),  # æ¯5å¹´æ˜¾ç¤ºä¸€ä¸ªæ ‡ç­¾
                     labels = seq(1992, 2023, by = 5)) +  # æ ‡ç­¾ä¸ breaks ä¸€è‡´
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # æ—‹è½¬æ¨ªè½´æ ‡ç­¾ï¼Œé¿å…é‡å 

# ç»˜åˆ¶ç»å¯¹å€¼å¯¹æ¯”æ•£ç‚¹å›¾
ggplot(data, aes(x = PublicRevenue, y = PublicExpenditure)) +
  geom_point() +
  geom_smooth(method = "lm", col = "blue") +
  labs(title = "Scatter Plot of Public Revenue vs Public Expenditure (1992-2023)",
       x = "Public Revenue (äº¿)",
       y = "Public Expenditure (äº¿)") +
  theme_minimal()

# è®¡ç®—ç»å¯¹å€¼ç›¸å…³ç³»æ•°
correlation <- cor(data$PublicRevenue, data$PublicExpenditure, use = "complete.obs")
print(paste("The correlation coefficient between Public Revenue and Public Expenditure is:", correlation))
```

## è´¢æ”¿æ”¶æ”¯å¹³è¡¡

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)

# è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\è¡¨æ ¼.xlsx")

# å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡
colnames(data) <- c("Year", "GDP", "PublicRevenue", "PublicExpenditure", "DebtInterestPayment")

# æ¸…ç†æ•°æ®ï¼Œç§»é™¤ç©ºè¡Œ
data <- data %>% filter(!is.na(Year))

# ä»…ä¿ç•™2007å¹´ä»¥åçš„æ•°æ®
data <- data %>% filter(Year >= 2007)

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# æ‹†åˆ†ä¸€èˆ¬å…¬å…±é¢„ç®—æ”¯å‡ºä¸ºéåˆ©æ¯æ”¯å‡ºå’Œåˆ©æ¯æ”¯å‡º
data <- data %>%
  mutate(NonInterestExpenditure = PublicExpenditure - DebtInterestPayment,
         InterestExpenditure = DebtInterestPayment)

# å°†æ•°æ®è½¬æ¢ä¸ºé•¿æ ¼å¼ï¼Œä¾¿äºç»˜å›¾
data_long <- data %>%
  pivot_longer(cols = c(NonInterestExpenditure, InterestExpenditure),
               names_to = "ExpenditureType",
               values_to = "ExpenditureValue")

# ç»˜åˆ¶é¢ç§¯å †ç§¯å›¾å’ŒæŠ˜çº¿å›¾
ggplot() +
  # ç»˜åˆ¶éåˆ©æ¯æ”¯å‡ºå’Œåˆ©æ¯æ”¯å‡ºçš„é¢ç§¯å †ç§¯å›¾
  geom_area(data = data_long, aes(x = Year, y = ExpenditureValue, fill = ExpenditureType), alpha = 0.6) +
  # ç»˜åˆ¶ä¸€èˆ¬å…¬å…±é¢„ç®—æ”¶å…¥çš„æŠ˜çº¿å›¾
  geom_line(data = data, aes(x = Year, y = PublicRevenue, color = "Public Revenue"), size = 1.2) +
  # è®¾ç½®æ ‡é¢˜å’Œæ ‡ç­¾
  labs(title = "Public Expenditure Breakdown and Revenue (2007-2023)",
       x = "Year",
       y = "Amount (äº¿)",
       fill = "Expenditure Type",
       color = "Indicator") +
  # è®¾ç½®æ¨ªè½´æ ‡æ³¨é—´éš”
  scale_x_continuous(breaks = seq(2007, 2023, by = 2)) +
  # è®¾ç½®é¢œè‰²å’Œå›¾ä¾‹
  scale_fill_manual(values = c("NonInterestExpenditure" = "skyblue", "InterestExpenditure" = "orange")) +
  scale_color_manual(values = c("Public Revenue" = "red")) +
  # è®¾ç½®ä¸»é¢˜
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## ä¸€èˆ¬å…¬å…±é¢„ç®—æ”¶å…¥ç»†åˆ†

```{r}
# åŠ è½½å¿…è¦çš„åŒ…
library(readxl)
library(dplyr)
library(gridExtra)

# è¯»å–Excelæ–‡ä»¶
data <- read_excel("C:\\Users\\zhy\\Desktop\\ç»†åˆ†å…¬å…±é¢„ç®—æ”¯å‡º.xlsx")

# å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡
colnames(data) <- c("Index", "Year", "TotalExpenditure", "GeneralPublicServices", "Diplomacy", "Defense", "PublicSafety", 
                    "Education", "ScienceTechnology", "CultureSportsMedia", "SocialSecurityEmployment", "HealthcareFamilyPlanning", 
                    "EnergyConservationEnvironmentalProtection", "UrbanRuralCommunityAffairs", "AgricultureForestryWater", 
                    "Transportation", "ResourceExplorationElectricityInformation", "CommerceServices", "FinancialRegulation", 
                    "AidOtherRegions", "HousingSecurity", "GrainMaterialReserves", "DebtInterestPayment", "OtherExpenditure", 
                    "PublicRevenue")

# æ¸…ç†æ•°æ®ï¼Œç§»é™¤ç©ºè¡Œ
data <- data %>% filter(!is.na(Year))

# ä»…ä¿ç•™2007-2023å¹´çš„æ•°æ®
data <- data %>% filter(Year >= 2007 & Year <= 2023)

# ç¡®ä¿ Year æ˜¯æ•°å€¼å‹
data$Year <- as.numeric(data$Year)

# å°†æ‰€æœ‰æ”¯å‡ºåˆ—è½¬æ¢ä¸ºæ•°å€¼å‹
data <- data %>%
  mutate(across(TotalExpenditure:OtherExpenditure, as.numeric))

# è®¡ç®—å„é¡¹æ”¯å‡ºçš„ CAGR
growth_rates <- data %>%
  summarise(across(TotalExpenditure:OtherExpenditure, 
                   ~ (last(.) / first(.))^(1 / (n() - 1)) - 1, 
                   .names = "CAGR_{col}"))

# è®¡ç®—æ¯é¡¹æ”¯å‡ºçš„æ ‡å‡†å·®
std_dev <- data %>%
  summarise(across(TotalExpenditure:OtherExpenditure, 
                   ~ sd((. - lag(.)) / lag(.) * 100, na.rm = TRUE), 
                   .names = "StdDev_{col}"))

# æ ‡è®°å¼‚å¸¸å€¼ï¼ˆå¢é€Ÿè¶…è¿‡å¹³å‡å€¼ Â± 2å€æ ‡å‡†å·®ï¼‰
anomalies <- data %>%
  mutate(across(TotalExpenditure:OtherExpenditure, 
                ~ ifelse(abs((. - lag(.)) / lag(.) * 100 - mean((. - lag(.)) / lag(.) * 100, na.rm = TRUE)) > 
                           2 * sd((. - lag(.)) / lag(.) * 100, na.rm = TRUE), "å¼‚å¸¸", "æ­£å¸¸"), 
                .names = "Anomaly_{col}"))

# æ±‡æ€»å¼‚å¸¸å€¼æ€»æ•°
anomaly_counts <- anomalies %>%
  summarise(across(starts_with("Anomaly"), ~ sum(. == "å¼‚å¸¸", na.rm = TRUE)))

# è¾“å‡ºç»“æœ
result <- data.frame(
  Category = gsub("CAGR_", "", colnames(growth_rates)),  # å»æ‰ "CAGR_" å‰ç¼€
  AverageGrowthRate = as.numeric(-growth_rates[1, ]),
  StandardDeviation = as.numeric(std_dev[1, ]),
  Anomalies = as.numeric(anomaly_counts[1, ])
)



# å°† result è½¬æ¢ä¸ºè¡¨æ ¼å›¾å½¢å¯¹è±¡
table_grob <- gridExtra::tableGrob(result, theme = gridExtra::ttheme_minimal(base_size = 10))

# ä½¿ç”¨ ggplot2 ç»˜åˆ¶è¡¨æ ¼
p <- ggplot() +
  annotation_custom(table_grob, xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
  theme_void()  # ä½¿ç”¨ç©ºç™½ä¸»é¢˜

# ä¿å­˜ä¸ºå›¾ç‰‡
ggsave("result_table.png", p, width = 12, height = 8, dpi = 300)

```

## æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡ŒvsåŸé•‡å›ºæŠ•

```{r}
# åŠ è½½å¿…è¦çš„åº“
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)

df <- read_excel("C:\\Users\\zhy\\Desktop\\å€ºåˆ¸å‘è¡Œé¢vså›ºæŠ•.xlsx")

# è½¬æ¢åˆ—åä¸ºè‹±æ–‡
colnames(df) <- c("Index", "Date", "LocalGovBond", "FixedAssetInvestment")

# æ£€æŸ¥æ•°æ®ç±»å‹
str(df)

# å°† Date åˆ—è½¬æ¢ä¸ºæ—¥æœŸæ ¼å¼
df$Date <- as.Date(paste0(df$Date, "-01"), format = "%Y-%m-%d")

# å°† LocalGovBond å’Œ FixedAssetInvestment åˆ—è½¬æ¢ä¸ºæ•°å€¼å‹
df$LocalGovBond <- as.numeric(df$LocalGovBond)
df$FixedAssetInvestment <- as.numeric(df$FixedAssetInvestment)

# ç­›é€‰ 2018 å¹´è‡³ä»Šçš„æ•°æ®
df <- df %>% filter(Date >= as.Date("2018-01-01"))

# ç§»é™¤åŒ…å«ç¼ºå¤±å€¼çš„è¡Œ
df <- df %>% drop_na(LocalGovBond, FixedAssetInvestment)

# å†æ¬¡æ£€æŸ¥æ•°æ®
head(df)

# ç»˜åˆ¶æŠ˜çº¿å›¾
ggplot(df, aes(x = Date)) +
  geom_line(aes(y = LocalGovBond, color = "åœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢"), size = 1) +
  geom_line(aes(y = FixedAssetInvestment, color = "åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢"), size = 1) +
  labs(
    title = "2018å¹´è‡³ä»Šåœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢ä¸åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢",
    x = "æ—¥æœŸ",
    y = "é‡‘é¢ï¼ˆäº¿å…ƒï¼‰",
    color = "æŒ‡æ ‡"
  ) +
  theme_minimal() +
  scale_color_manual(
    values = c("åœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢" = "blue", "åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢" = "red")
  ) +
  scale_x_date(date_labels = "%Y-%m", date_breaks = "6 months") +  # æ¯6ä¸ªæœˆæ˜¾ç¤ºä¸€ä¸ªæ—¥æœŸæ ‡ç­¾
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # æ—‹è½¬ x è½´æ ‡ç­¾


# 1. ç»˜åˆ¶æ•£ç‚¹å›¾
ggplot(df, aes(x = LocalGovBond, y = FixedAssetInvestment)) +
  geom_point(color = "blue", size = 3) +  # ç»˜åˆ¶æ•£ç‚¹
  geom_smooth(method = "lm", color = "red", linetype = "dashed") +  # æ·»åŠ çº¿æ€§æ‹Ÿåˆçº¿
  labs(
    title = "åœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢ vs åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢",
    x = "åœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢ï¼ˆäº¿å…ƒï¼‰",
    y = "åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢ï¼ˆäº¿å…ƒï¼‰"
  ) +
  theme_minimal()

# 2. è®¡ç®—ç›¸å…³æ€§
correlation <- cor(df$LocalGovBond, df$FixedAssetInvestment, use = "complete.obs")
print(paste("åœ°æ–¹æ”¿åºœä¸“é¡¹å€ºåˆ¸å‘è¡Œé¢ä¸åŸé•‡å›ºå®šèµ„äº§æŠ•èµ„å®Œæˆé¢çš„ç›¸å…³æ€§ä¸º:", round(correlation, 2)))
```
